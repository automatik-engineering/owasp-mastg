rules:
  - id: mastg-android-sensitive-data-to-embedded-firebase-analytics
    severity: WARNING
    languages: [java]
    metadata:
      summary: "Detects sensitive data being sent to Firebase Analytics."
    message: "[MASVS-PLATFORM-2] Sensitive data is being sent to Firebase Analytics"
    mode: taint
    pattern-sources:
      - patterns:
          - pattern: '"$SECRET"'
          - metavariable-analysis:
              metavariable: $SECRET
              analyzer: entropy
      - patterns:
          - pattern: '"$EMAIL"'
          - metavariable-regex:
              metavariable: $EMAIL
              regex: (?i)[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}
      - patterns:
          - pattern: '"$FULLNAME"'
          - metavariable-regex:
              metavariable: $FULLNAME
              regex: (?i)[A-Z][a-z]+ [A-Z][a-z]+
      - patterns:
          - pattern: '"$UID"'
          - metavariable-regex:
              metavariable: $UID
              regex: (?i)user[0-9]+
    pattern-sinks:
      - pattern: $FA.logEvent($EVT, $ARG)
      - pattern: $FA.setUserProperty($NAME, $ARG)
      - pattern: $FA.setUserId($ARG)
      - pattern: $FA.setDefaultEventParameters($ARG)
      - pattern: $BUNDLE.putString($K, $V)
        pattern-inside: |
          ...;
          $FA.logEvent($EVT, $BUNDLE);
          ...;
    pattern-propagators:
      - pattern: $BUNDLE.putString($K, $V)
        from: $V
        to: $BUNDLE